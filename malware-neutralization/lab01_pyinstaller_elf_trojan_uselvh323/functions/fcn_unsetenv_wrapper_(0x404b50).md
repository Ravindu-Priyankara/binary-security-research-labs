# `fcn_unsetenv_wrapper` (`0x404b50`)

## Purpose

Wrapper function that **removes an environment variable** using `unsetenv()`.

In this execution flow, it is used immediately after retrieving and duplicating
the `_MEIPASS2` environment variable into heap memory.

---

## Inputs

* **`rdi`** → Environment variable name
  (in this case: `"_MEIPASS2"`)

---

## Behavior

1. Performs an unconditional jump to `unsetenv()`
2. Does not allocate stack space
3. Does not modify arguments
4. Does not process the return value

---

## Disassembly

```asm
fcn.00404b50:
    jmp sym.imp.unsetenv
```

---

## Reconstructed C Code

```c
void unsetenv_wrapper(const char *name) {
    unsetenv(name);
}
```

---

## Output

* The specified environment variable is removed from the process environment
* Any code relying on `getenv("_MEIPASS2")` after this point will receive `NULL`

---

## Analysis Notes

### Observed Execution Context

Relevant call sequence from `main`:

```asm
call path_to_dirname_wrapper

mov edi, "_MEIPASS2"
call getenv_heap_copy      ; getenv + strdup → heap copy

mov edi, "_MEIPASS2"
mov rbp, rax               ; save heap copy
call unsetenv_wrapper      ; remove original env var
```

### What this means

This pattern strongly indicates:

1. `_MEIPASS2` is **read once**
2. Its value is **duplicated into heap memory**
3. The original environment variable is **immediately removed**

This guarantees:

* The value persists internally
* The environment no longer exposes it

---

### Why malware / loaders do this

This is a **classic loader hygiene pattern**, commonly used to:

* Hide runtime configuration from:

  * Child processes
  * Debuggers
  * Sandboxes
  * Memory snapshots
* Prevent detection via environment inspection
* Avoid re-use or accidental leakage of sensitive paths
* Ensure one-time initialization behavior

---

### `_MEIPASS2` significance

`_MEIPASS2` is strongly associated with:

* **PyInstaller bootloaders**
* Temporary extraction directories
* Embedded Python runtime staging paths

However, the technique itself is **generic** and reusable in custom malware:

* Read config once
* Copy to heap
* Erase external trace

---


## Appendix

<img src="./assets/fcn_unsetenv_wrapper_(0x404b50).png" width="500">