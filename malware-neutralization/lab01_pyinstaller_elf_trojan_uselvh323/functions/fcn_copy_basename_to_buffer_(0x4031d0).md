# `fcn_copy_basename_to_buffer` (`0x4031d0`)

## Purpose

Extract the executable **basename** from `argv[0]` and copy it into a caller‑provided buffer.

---

## Inputs

* **`rdi`** → Destination buffer (stack‑allocated by caller)
* **`rsi`** → Path string (`argv[0]`)

---

## Behavior

1. Passes the path string (`argv[0]`) to `__xpg_basename()` to extract the final path component.
2. Copies the resulting basename into the destination buffer using `strcpy()`.

This function performs no validation and assumes the destination buffer is large enough.

---

## Reconstructed C Code

```c
void copy_basename_to_buffer(char *dest, const char *path) {
    strcpy(dest, basename(path));
}
```

---

## Output

* The basename of the executable (derived from `argv[0]`) is stored in the destination buffer on the stack.

---

## Analysis Notes

### Why malware commonly performs this operation

Extracting the executable basename is a frequent precursor to:

* Generating mutex or lock names
* Constructing temporary or drop filenames
* Creating persistence entries (e.g., startup scripts, registry keys)
* Dropping or relocating copies using the same filename
* Validating the expected executable name
* Performing anti‑analysis checks (unexpected name → early exit)

---

### `basename()` implementation details

* `basename()` may **modify its input buffer** on some libc implementations.
* This binary uses `__xpg_basename`, the POSIX/XPG‑compliant variant.
* Malware authors sometimes explicitly use this variant for **portability and predictable behavior** across environments.

---

## Appendix

<img src="./assets/fcn_copy_basename_to_buffer_(0x4031d0).png" width="500">

---
